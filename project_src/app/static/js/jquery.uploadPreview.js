(function(f){jQuery.fn.extend({uploadPreview:function(b){b=jQuery.extend({width:null,height:null,fillBox:!1,imgDiv:"#imgDiv",anyTarget:null,maxSize:300,imgType:["gif","jpeg","jpg","bmp","png"],uploadButton:"#uploadHeadphoto",uploadModal:"#headUploadModal",callback:function(){return!1}},b||{});var k=f(this),c=f(b.imgDiv),g=f(b.uploadButton);f(b.uploadModal);b.width&&c.width(b.width);b.height&&c.height(b.height);var l="Microsoft Internet Explorer"==navigator.appName,m=navigator.appVersion,h;l&&(h=m.split(";")[1].replace(/MSIE[ ]/g,
"").replace(".0",""));handle=function(){var a=c.find("img");b.anyTarget&&f.each(b.anyTarget.split(","),function(b,e){f(e).html(a.clone())});b.fillBox?a.width(b.width).height(b.height):autoResize(a);b.callback(a)};autoResize=function(a){var d=b.height,e=b.width;if(a.height()>d){var c=d/a.height();a.width(a.width()*c);a.height(d)}a.width()>e&&(c=e/a.width(),a.height(a.height()*c),a.width(e));d=(b.width-a.width())/2;e=(b.height-a.height())/2;a.parent().css({"padding-left":d+"px","padding-top":e+"px"});
f(a).css({"border-radius":"10px"}).show()};createImg=function(){g.removeAttr("disabled");c.html("");var a=f("<img />");c.append(a);f(a).hide();return a};k.change(function(){if(this.value){if(!RegExp(".("+b.imgType.join("|")+")$","i").test(this.value.toLowerCase()))return alert("\u56fe\u7247\u7c7b\u578b\u5fc5\u987b\u662f"+b.imgType.join("\uff0c")+"\u4e2d\u7684\u4e00\u79cd"),this.value="",!1;if(l&&10>h)if(6==h){var a=new Image;a.onload=function(){if(a.fileSize/1024>b.maxSize)return alert("\u56fe\u7247\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7"+
b.maxSize+"K"),console.log("a"),g.attr("disabled","disabled"),c.html(""),!1};a.src="file:///"+this.value;createImg().attr("src",a.src);handle()}else{var d=document.selection.createRange().text||f(this).val(),a=f("<img />");a.load(function(){if(a.fileSize/1024>b.maxSize)return alert("\u56fe\u7247\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7"+b.maxSize+"K"),console.log("b"),g.attr("disabled","disabled"),c.html(""),!1});a.attr("src",d);c.html("");a.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src='"+
d+"')"});c.append(a);setTimeout(handle,100)}else try{var e=null,j=0;this.files&&this.files[0]?(e=this.files[0],j=e.size):this.files&&this.files.item(0)&&(e=this.files.item(0),j=e.fileSize);if(j/1024>b.maxSize)return alert("\u56fe\u7247\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7"+b.maxSize+"K"),g.attr("disabled","disabled"),c.html(""),!1;d=createImg();try{d.attr("src",e.getAsDataURL())}catch(k){d.attr("src",window.URL.createObjectURL(e))}d.css({"vertical-align":"middle"});setTimeout(handle,100)}catch(m){if(this.files&&
this.files[0]){if(this.files[0].size/1024>b.maxSize)return alert("\u56fe\u7247\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7"+b.maxSize+"K"),g.attr("disabled","disabled"),c.html(""),!1;d=new FileReader;d.onload=function(a){c.attr("src",a.target.result)};d.readAsDataURL(this.files[0]);setTimeout(handle,100)}}}})}})})(jQuery);
